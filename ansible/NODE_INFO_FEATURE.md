# èŠ‚ç‚¹ä¿¡æ¯æ”¶é›†å’Œæ—¥å¿—è®°å½•åŠŸèƒ½

## âœ¨ æ–°å¢žåŠŸèƒ½

### 1. éƒ¨ç½²å‰èŠ‚ç‚¹ä¿¡æ¯æ”¶é›†

åœ¨SSHå…å¯†ç™»å½•é…ç½®æˆåŠŸåŽï¼Œéƒ¨ç½²å‰ä¼šè‡ªåŠ¨æ”¶é›†å¹¶æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ã€‚

#### æ”¶é›†çš„ä¿¡æ¯åŒ…æ‹¬ï¼š

**ç½‘ç»œä¿¡æ¯**ï¼š
- è‡ªåŠ¨è¯†åˆ« `eth`ã€`en`ã€`bond` å¼€å¤´çš„ç½‘å¡
- æ˜¾ç¤ºæ¯ä¸ªç½‘å¡çš„IPåœ°å€
- æ ¼å¼ï¼š`eth0:192.168.1.10`

**ç£ç›˜ä¿¡æ¯**ï¼š
- `lsblk` è¾“å‡ºï¼šæ˜¾ç¤ºç£ç›˜å¸ƒå±€ã€å¤§å°ã€ç±»åž‹ã€æŒ‚è½½ç‚¹
- `df -h` è¾“å‡ºï¼šæ˜¾ç¤º `/dev` å¼€å¤´çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ

#### æ˜¾ç¤ºæ ¼å¼ï¼š

```
================================================================================
èŠ‚ç‚¹: 10.200.3.14 (Master)
================================================================================

ç½‘ç»œä¿¡æ¯:
  eth0:10.200.3.14
  bond0:10.200.3.100

ç£ç›˜ä¿¡æ¯ (lsblk):
  NAME   SIZE TYPE MOUNTPOINT
  sda    100G disk 
  â”œâ”€sda1   1G part /boot
  â””â”€sda2  99G part /

ç£ç›˜ä½¿ç”¨æƒ…å†µ (df -h):
  /dev/sda1  1.0G  200M  800M  20% /boot
  /dev/sda2   99G   50G   49G  51% /
```

### 2. ç”¨æˆ·ç¡®è®¤æœºåˆ¶

æ”¶é›†å®Œä¿¡æ¯åŽï¼Œä¼šè¦æ±‚ç”¨æˆ·ç¡®è®¤ï¼š

```
è¯·ä»”ç»†æ£€æŸ¥ä»¥ä¸ŠèŠ‚ç‚¹ä¿¡æ¯ï¼Œç¡®è®¤æ— è¯¯åŽè¾“å…¥ Y ç»§ç»­éƒ¨ç½²ï¼Œè¾“å…¥ N å–æ¶ˆ:
```

- è¾“å…¥ `Y` æˆ– `y`ï¼šç»§ç»­éƒ¨ç½²
- è¾“å…¥å…¶ä»–ä»»ä½•å†…å®¹ï¼šå–æ¶ˆéƒ¨ç½²

### 3. å®Œæ•´çš„æ—¥å¿—è®°å½•

æ‰€æœ‰éƒ¨ç½²è¿‡ç¨‹éƒ½ä¼šè®°å½•åˆ° `deploy.log` æ–‡ä»¶ä¸­ã€‚

#### æ—¥å¿—ç‰¹æ€§ï¼š

- **è¿½åŠ æ¨¡å¼**ï¼šä¸ä¼šè¦†ç›–ä¹‹å‰çš„æ—¥å¿—ï¼ŒåŽ†å²è®°å½•éƒ½ä¿ç•™
- **æ—¶é—´æˆ³**ï¼šæ¯æ¡æ—¥å¿—éƒ½å¸¦æœ‰æ—¶é—´æˆ³ `[2025-12-17 13:30:45]`
- **å®Œæ•´è®°å½•**ï¼š
  - æ‰€æœ‰ç”¨æˆ·è¾“å…¥
  - æ‰€æœ‰å‘½ä»¤æ‰§è¡Œ
  - ansible-playbook çš„å®Œæ•´è¾“å‡º
  - é”™è¯¯ä¿¡æ¯å’Œè­¦å‘Š

#### æ—¥å¿—ç¤ºä¾‹ï¼š

```
[2025-12-17 13:30:45] ========================================
[2025-12-17 13:30:45] Curvineé›†ç¾¤ä¸€é”®éƒ¨ç½²å·¥å…·
[2025-12-17 13:30:45] æ—¥å¿—æ–‡ä»¶: /root/kolla1/deploy.log
[2025-12-17 13:30:45] ========================================
[2025-12-17 13:30:45] 
[2025-12-17 13:30:45] æ£€æŸ¥å¿…è¦æ–‡ä»¶...
[2025-12-17 13:30:45] 
[2025-12-17 13:30:45] å¿«é€Ÿæ£€æµ‹èŠ‚ç‚¹è¿žæŽ¥çŠ¶æ€ (è¶…æ—¶3ç§’)...
[2025-12-17 13:30:48] æ£€æŸ¥MasterèŠ‚ç‚¹...
[2025-12-17 13:30:50]   âœ“ 10.200.3.14
[2025-12-17 13:30:52]   âœ“ 10.200.3.8
...
```

### 4. èŠ‚ç‚¹ä¿¡æ¯ä¿å­˜

èŠ‚ç‚¹ä¿¡æ¯ä¼šä¿å­˜åˆ° `node_info_summary.txt` æ–‡ä»¶ï¼Œæ–¹ä¾¿åŽç»­æŸ¥çœ‹å’Œå®¡è®¡ã€‚

## ðŸ“‹ ä½¿ç”¨æµç¨‹

```bash
# 1. è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy_all.sh

# 2. é…ç½®SSHå…å¯†ç™»å½•ï¼ˆå¦‚éœ€è¦ï¼‰
# è¾“å…¥å¯†ç ...

# 3. è‡ªåŠ¨æ”¶é›†èŠ‚ç‚¹ä¿¡æ¯
# æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹çš„ç½‘ç»œå’Œç£ç›˜ä¿¡æ¯

# 4. ç¡®è®¤èŠ‚ç‚¹ä¿¡æ¯
# è¾“å…¥ Y ç»§ç»­

# 5. ç¡®è®¤å¼€å§‹éƒ¨ç½²
# è¾“å…¥ y ç»§ç»­

# 6. éƒ¨ç½²è¿‡ç¨‹è‡ªåŠ¨è®°å½•åˆ°deploy.log
```

## ðŸ“Š æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹å®Œæ•´æ—¥å¿—
cat deploy.log

# æŸ¥çœ‹æœ€åŽ100è¡Œ
tail -n 100 deploy.log

# å®žæ—¶æŸ¥çœ‹æ—¥å¿—
tail -f deploy.log

# æœç´¢ç‰¹å®šå†…å®¹
grep "ERROR" deploy.log
grep "å¤±è´¥" deploy.log

# æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„æ—¥å¿—
grep "2025-12-17 13:30" deploy.log
```

## ðŸ“ ç”Ÿæˆçš„æ–‡ä»¶

- `deploy.log` - éƒ¨ç½²æ—¥å¿—ï¼ˆè¿½åŠ æ¨¡å¼ï¼‰
- `node_info_summary.txt` - èŠ‚ç‚¹ä¿¡æ¯æ±‡æ€»

è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½åœ¨è„šæœ¬æ‰§è¡Œç›®å½•ä¸‹ã€‚

## ðŸ” å•ç‹¬æ”¶é›†èŠ‚ç‚¹ä¿¡æ¯

å¦‚æžœåªæƒ³æ”¶é›†èŠ‚ç‚¹ä¿¡æ¯è€Œä¸éƒ¨ç½²ï¼š

```bash
ansible-playbook collect_node_info.yml
```

è¿™ä¼šï¼š
1. æ”¶é›†æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯
2. æ˜¾ç¤ºåœ¨ç»ˆç«¯
3. ä¿å­˜åˆ° `node_info_summary.txt`

## ðŸŽ¯ æ”¶é›†ç‰¹å®šèŠ‚ç‚¹ä¿¡æ¯

```bash
# åªæ”¶é›†MasterèŠ‚ç‚¹
ansible-playbook collect_node_info.yml --limit master

# åªæ”¶é›†WorkerèŠ‚ç‚¹
ansible-playbook collect_node_info.yml --limit worker

# æ”¶é›†ç‰¹å®šIPçš„èŠ‚ç‚¹
ansible-playbook collect_node_info.yml --limit 10.200.3.15
```

## ðŸ’¡ ä½¿ç”¨å»ºè®®

1. **éƒ¨ç½²å‰æ£€æŸ¥**ï¼š
   - ç¡®è®¤ç½‘ç»œé…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç£ç›˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿ
   - ç¡®è®¤æŒ‚è½½ç‚¹æ˜¯å¦æ­£ç¡®

2. **æ—¥å¿—ç®¡ç†**ï¼š
   - å®šæœŸå¤‡ä»½ `deploy.log`
   - é‡è¦éƒ¨ç½²å‰å¯ä»¥é‡å‘½åæ—¥å¿—æ–‡ä»¶ä¿å­˜
   - ä½¿ç”¨ `grep` å¿«é€ŸæŸ¥æ‰¾é”™è¯¯

3. **é—®é¢˜æŽ’æŸ¥**ï¼š
   - éƒ¨ç½²å¤±è´¥æ—¶ï¼ŒæŸ¥çœ‹ `deploy.log` ä¸­çš„é”™è¯¯ä¿¡æ¯
   - å¯¹æ¯” `node_info_summary.txt` ç¡®è®¤é…ç½®

4. **å®¡è®¡å’Œæ–‡æ¡£**ï¼š
   - ä¿å­˜æ¯æ¬¡éƒ¨ç½²çš„æ—¥å¿—å’ŒèŠ‚ç‚¹ä¿¡æ¯
   - ä½œä¸ºéƒ¨ç½²è®°å½•å’Œå®¡è®¡ä¾æ®

## ðŸš¨ æ³¨æ„äº‹é¡¹

1. `deploy.log` æ˜¯è¿½åŠ æ¨¡å¼ï¼Œä¼šä¸æ–­å¢žå¤§ï¼Œå»ºè®®å®šæœŸæ¸…ç†æˆ–å½’æ¡£
2. æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰ä¸ä¼šè®°å½•åˆ°æ—¥å¿—ä¸­
3. æ—¥å¿—æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`ï¼Œä¸ä¼šæäº¤åˆ°ç‰ˆæœ¬æŽ§åˆ¶
4. èŠ‚ç‚¹ä¿¡æ¯æ”¶é›†éœ€è¦èŠ‚ç‚¹å·²é…ç½®SSHå…å¯†ç™»å½•

## ðŸ“ž ç›¸å…³å‘½ä»¤

```bash
# æ¸…ç©ºæ—¥å¿—ï¼ˆè°¨æ…Žä½¿ç”¨ï¼‰
> deploy.log

# å½’æ¡£æ—¥å¿—
mv deploy.log deploy.log.$(date +%Y%m%d_%H%M%S)

# åŽ‹ç¼©æ—§æ—¥å¿—
tar -czf deploy_logs_$(date +%Y%m%d).tar.gz deploy.log* node_info_summary.txt
```

